import fetch from "node-fetch";

const placeholderImage = {
  book: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='256' height='256' viewBox='0 0 256 256' xml:space='preserve'%3E%3Cdefs%3E%3C/defs%3E%3Cg style='stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;' transform='translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)' %3E%3Cpolygon points='89,67.44 49.92,85.3 49.92,31.17 89,13.32 ' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(192,58,43); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) '/%3E%3Cpolygon points='1,67.44 40.08,85.3 40.08,31.17 1,13.32 ' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(230,76,60); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) '/%3E%3Crect x='40.08' y='31.17' rx='0' ry='0' width='9.84' height='54.12' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(192,58,43); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) '/%3E%3Cpolygon points='75.62,46.9 62.23,53.02 62.23,34.46 75.62,28.34 ' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(228,197,76); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) '/%3E%3Cpolygon points='14.38,46.9 27.77,53.02 27.77,34.46 14.38,28.34 ' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(228,197,76); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) '/%3E%3Cpath d='M 62.227 54.021 c -0.188 0 -0.377 -0.054 -0.541 -0.158 c -0.286 -0.185 -0.459 -0.501 -0.459 -0.842 V 34.464 c 0 -0.392 0.229 -0.747 0.584 -0.91 l 13.397 -6.122 c 0.31 -0.141 0.669 -0.117 0.957 0.068 c 0.286 0.184 0.459 0.501 0.459 0.841 v 18.556 c 0 0.392 -0.229 0.747 -0.584 0.909 L 62.643 53.93 C 62.51 53.99 62.368 54.021 62.227 54.021 z M 63.227 35.107 v 16.357 l 11.397 -5.208 V 29.899 L 63.227 35.107 z M 75.624 46.898 h 0.01 H 75.624 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 45 29.558 c 0 -14.278 -5.541 -20.45 -18.583 -24.855 v 8.617 L 45 29.558 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(205,191,135); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 45 30.558 c -0.237 0 -0.472 -0.084 -0.658 -0.247 L 25.759 14.073 c -0.217 -0.19 -0.342 -0.464 -0.342 -0.753 V 4.703 c 0 -0.322 0.155 -0.625 0.417 -0.813 s 0.598 -0.238 0.903 -0.135 C 40.779 8.499 46 15.492 46 29.558 c 0 0.392 -0.229 0.748 -0.586 0.911 C 45.281 30.529 45.14 30.558 45 30.558 z M 27.417 12.866 l 16.534 14.448 c -0.51 -11.246 -5.063 -17.034 -16.534 -21.201 V 12.866 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 45 31.174 v -1.616 c 0 -3.658 -1.816 -7.109 -4.896 -9.084 C 31.146 14.727 20.799 11.142 9.588 8.9 c 0 0 -8.588 4.42 -8.588 4.42 l 39.078 17.855 H 45 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(205,191,135); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 45 31.174 v -1.616 c 0 -3.658 1.816 -7.109 4.896 -9.084 c 8.959 -5.747 19.306 -9.332 30.517 -11.574 c 0 0 8.588 4.42 8.588 4.42 L 49.922 31.174 H 45 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(205,191,135); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 62.228 61.162 c -0.38 0 -0.742 -0.217 -0.91 -0.584 c -0.229 -0.503 -0.009 -1.096 0.493 -1.325 l 13.397 -6.121 c 0.504 -0.23 1.096 -0.008 1.325 0.493 c 0.229 0.503 0.009 1.096 -0.493 1.325 l -13.397 6.121 C 62.508 61.133 62.366 61.162 62.228 61.162 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 62.228 68.305 c -0.38 0 -0.742 -0.217 -0.91 -0.584 c -0.229 -0.503 -0.009 -1.096 0.493 -1.325 l 13.397 -6.122 c 0.504 -0.231 1.096 -0.009 1.325 0.493 c 0.229 0.503 0.009 1.096 -0.493 1.325 l -13.397 6.122 C 62.508 68.275 62.366 68.305 62.228 68.305 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 27.773 54.021 c -0.142 0 -0.283 -0.03 -0.416 -0.091 L 13.96 47.808 c -0.356 -0.162 -0.584 -0.518 -0.584 -0.909 V 28.343 c 0 -0.34 0.173 -0.657 0.459 -0.841 c 0.286 -0.184 0.646 -0.209 0.956 -0.068 l 13.398 6.122 c 0.356 0.163 0.584 0.518 0.584 0.91 v 18.556 c 0 0.341 -0.173 0.657 -0.459 0.842 C 28.15 53.967 27.962 54.021 27.773 54.021 z M 15.375 46.256 l 11.398 5.208 V 35.107 l -11.398 -5.208 V 46.256 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 27.773 61.162 c -0.139 0 -0.28 -0.029 -0.415 -0.091 L 13.96 54.95 c -0.502 -0.229 -0.724 -0.822 -0.494 -1.325 c 0.229 -0.502 0.821 -0.723 1.325 -0.493 l 13.398 6.121 c 0.502 0.229 0.724 0.822 0.494 1.325 C 28.515 60.945 28.152 61.162 27.773 61.162 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 27.773 68.305 c -0.139 0 -0.28 -0.029 -0.415 -0.091 L 13.96 62.092 c -0.502 -0.229 -0.724 -0.822 -0.494 -1.325 c 0.229 -0.502 0.821 -0.723 1.325 -0.493 l 13.398 6.122 c 0.502 0.229 0.724 0.822 0.494 1.325 C 28.515 68.088 28.152 68.305 27.773 68.305 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 49.922 86.298 c -0.188 0 -0.377 -0.054 -0.541 -0.159 c -0.286 -0.184 -0.459 -0.5 -0.459 -0.841 V 31.174 c 0 -0.392 0.229 -0.747 0.584 -0.91 L 88.584 12.41 c 0.309 -0.141 0.669 -0.117 0.957 0.068 C 89.827 12.663 90 12.979 90 13.32 v 54.123 c 0 0.392 -0.229 0.747 -0.584 0.909 L 50.338 86.207 C 50.205 86.268 50.063 86.298 49.922 86.298 z M 50.922 31.817 v 51.924 L 88 66.8 V 14.876 L 50.922 31.817 z M 89 67.442 h 0.01 H 89 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 40.078 86.298 c -0.141 0 -0.283 -0.03 -0.416 -0.091 L 0.584 68.352 C 0.229 68.189 0 67.834 0 67.442 V 13.32 c 0 -0.34 0.173 -0.657 0.459 -0.841 c 0.286 -0.184 0.646 -0.21 0.956 -0.068 l 39.078 17.854 c 0.356 0.163 0.584 0.518 0.584 0.91 v 54.124 c 0 0.341 -0.173 0.657 -0.459 0.841 C 40.455 86.244 40.267 86.298 40.078 86.298 z M 2 66.8 l 37.078 16.941 V 31.817 L 2 14.876 V 66.8 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 49.922 86.298 h -9.844 c -0.552 0 -1 -0.447 -1 -1 V 31.174 c 0 -0.552 0.448 -1 1 -1 h 9.844 c 0.553 0 1 0.448 1 1 v 54.124 C 50.922 85.851 50.475 86.298 49.922 86.298 z M 41.078 84.298 h 7.844 V 32.174 h -7.844 V 84.298 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 45 32.174 h -4.922 c -0.144 0 -0.285 -0.031 -0.416 -0.09 L 0.584 14.229 C 0.236 14.07 0.009 13.726 0 13.343 c -0.009 -0.383 0.201 -0.737 0.542 -0.913 l 8.588 -4.42 c 0.201 -0.104 0.433 -0.137 0.654 -0.091 c 12.32 2.463 22.415 6.295 30.86 11.713 C 43.998 21.784 46 25.494 46 29.558 v 1.616 C 46 31.727 45.552 32.174 45 32.174 z M 40.296 30.174 H 44 v -0.616 c 0 -3.379 -1.658 -6.461 -4.436 -8.242 C 31.411 16.085 21.65 12.365 9.734 9.949 l -6.445 3.317 L 40.296 30.174 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3Cpath d='M 49.922 32.174 H 45 c -0.552 0 -1 -0.448 -1 -1 v -1.616 c 0 -4.064 2.002 -7.774 5.355 -9.926 c 8.446 -5.418 18.541 -9.25 30.86 -11.713 c 0.224 -0.045 0.453 -0.012 0.654 0.091 l 8.588 4.42 c 0.34 0.175 0.551 0.53 0.542 0.913 s -0.236 0.727 -0.584 0.886 L 50.338 32.084 C 50.207 32.144 50.065 32.174 49.922 32.174 z M 46 30.174 h 3.704 l 37.007 -16.908 l -6.445 -3.317 c -11.914 2.416 -21.675 6.135 -29.83 11.367 C 47.658 23.097 46 26.179 46 29.558 V 30.174 z' style='stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;' transform=' matrix(1 0 0 1 0 0) ' stroke-linecap='round' /%3E%3C/g%3E%3C/svg%3E",
  author:
    "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 61.8 66.358' id='avatar'%3E%3Cdefs%3E%3CclipPath id='clip-path'%3E%3Cpath fill='none' d='M53.456 52.022A30.766 30.766 0 0 1 30.9 61.829a31.163 31.163 0 0 1-3.833-.237 34.01 34.01 0 0 1-11.15-3.644 31.007 31.007 0 0 1-7.849-6.225l1.282-3.1 13.91-6.212c.625 3.723 7.806 8.175 7.806 8.175s7.213-3.412 8.087-8.211l12.777 6.281z' clip-rule='evenodd'%3E%3C/path%3E%3C/clipPath%3E%3CclipPath id='clip-path-2'%3E%3Cpath fill='none' d='M14.112 46.496l6.814-3.042 10.209 13.978 10.328-13.938 5.949 2.831v20.033h-33.3V46.496z' clip-rule='evenodd'%3E%3C/path%3E%3C/clipPath%3E%3C/defs%3E%3Cg id='Layer_2'%3E%3Cg id='_ÎÓÈ_1'%3E%3Ccircle cx='30.9' cy='30.9' r='30.9' fill='%233dbc93'%3E%3C/circle%3E%3Cpath fill='%23f9dca4' fill-rule='evenodd' d='M23.255 38.68l15.907.121v12.918l-15.907-.121V38.68z'%3E%3C/path%3E%3Cpath fill-rule='evenodd' d='M39.165 38.778v3.58a7.783 7.783 0 0 1-.098 1.18 6.527 6.527 0 0 1-.395 1.405c-5.374 4.164-13.939.748-15.306-6.365z' opacity='.11'%3E%3C/path%3E%3Cpath fill='%23ffe8be' fill-rule='evenodd' d='M31.129 8.432c21.281 0 12.987 35.266 0 35.266-12.266 0-21.281-35.266 0-35.266z'%3E%3C/path%3E%3Cpath fill='%23f9dca4' fill-rule='evenodd' d='M18.365 24.046c-3.07 1.339-.46 7.686 1.472 7.658a31.972 31.972 0 0 1-1.472-7.659zM44.135 24.046c3.07 1.339.465 7.686-1.466 7.657a31.978 31.978 0 0 0 1.466-7.657z'%3E%3C/path%3E%3Cpath fill='%23ecbe6a' fill-rule='evenodd' d='M44.123 24.17s7.96-11.785-2.636-16.334a11.881 11.881 0 0 0-12.87-5.22C22.775 3.805 20.604 6.7 20.604 6.7s-5.53 5.014-10.44 5.117a9.774 9.774 0 0 0 6.28 1.758c-.672 1.68-1.965 7.21 1.989 10.854 4.368-2.868 8.012-8.477 8.012-8.477s.982 3.257.207 4.86a18.879 18.879 0 0 0 7.922-3.531c2.542-2.036 3.893-4.297 5.31-4.326 3.256-.069 4.213 9.74 4.24 11.216z'%3E%3C/path%3E%3Cpath fill='%23498bd9' fill-rule='evenodd' d='M53.456 52.022A30.766 30.766 0 0 1 30.9 61.829a31.163 31.163 0 0 1-3.833-.237 34.01 34.01 0 0 1-11.15-3.644 31.007 31.007 0 0 1-7.849-6.225l1.282-3.1 13.91-6.212c.625 3.723 7.806 8.175 7.806 8.175s7.213-3.412 8.087-8.211l12.777 6.281z'%3E%3C/path%3E%3Cg clip-path='url(%23clip-path)'%3E%3Cpath fill='%23545f69' fill-rule='evenodd' d='M14.112 46.496l6.814-3.042 10.209 13.978 10.328-13.938 5.949 2.831v20.033h-33.3V46.496z'%3E%3C/path%3E%3Cg clip-path='url(%23clip-path-2)'%3E%3Cpath fill='%23434955' fill-rule='evenodd' d='M37.79 42.881h.732v21.382h-.732V42.881zm-14.775 0h.731v21.382h-.73V42.881zm-2.981 0h.731v21.382h-.731V42.881zm-2.944 0h.731v21.382h-.73V42.881zm-2.981 0h.731v21.382h-.731V42.881zm20.708 0h.731v21.382h-.731V42.881zm-2.981 0h.731v21.382h-.731V42.881zm-2.944 0h.731v21.382h-.731V42.881zm-2.981 0h.731v21.382h-.731V42.881zm20.785 0h.732v21.382h-.732V42.881zm-2.98 0h.73v21.382h-.73V42.881zm-2.944 0h.73v21.382h-.73z'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3Cpath fill='%2358b0e0' fill-rule='evenodd' d='m23.265 41.27 7.802 9.316-6.305 3.553-4.823-10.591 3.326-2.278zM39.155 41.45l-8.088 9.136 6.518 3.553 4.777-10.719-3.207-1.97z'%3E%3C/path%3E%3Cpath fill='%23464449' fill-rule='evenodd' d='M21.637 23.157h6.416a1.58 1.58 0 0 1 1.119.464v.002a1.579 1.579 0 0 1 .464 1.117v2.893a1.585 1.585 0 0 1-1.583 1.583h-6.416a1.578 1.578 0 0 1-1.116-.465h-.002a1.58 1.58 0 0 1-.464-1.118V24.74a1.579 1.579 0 0 1 .464-1.117l.002-.002a1.578 1.578 0 0 1 1.116-.464zm6.416.85h-6.416a.735.735 0 0 0-.517.214l-.001.002a.735.735 0 0 0-.214.517v2.893a.73.73 0 0 0 .215.517.735.735 0 0 0 .517.215h6.416a.735.735 0 0 0 .732-.732V24.74a.734.734 0 0 0-.214-.518.731.731 0 0 0-.518-.215zM34.548 23.157h6.416a1.58 1.58 0 0 1 1.118.464v.002a1.579 1.579 0 0 1 .465 1.117v2.893a1.585 1.585 0 0 1-1.583 1.583h-6.416a1.58 1.58 0 0 1-1.117-.465l-.001-.002a1.58 1.58 0 0 1-.465-1.116V24.74a1.58 1.58 0 0 1 .465-1.117l.002-.001a1.58 1.58 0 0 1 1.116-.465zm6.416.85h-6.416a.73.73 0 0 0-.517.214l-.001.002a.729.729 0 0 0-.214.517v2.893a.73.73 0 0 0 .214.517l.001.001a.73.73 0 0 0 .517.214h6.416a.735.735 0 0 0 .732-.732V24.74a.734.734 0 0 0-.214-.518h-.001a.731.731 0 0 0-.517-.215z'%3E%3C/path%3E%3Cpath fill='%23464449' d='M29.415 24.506h3.845v.876h-3.845z'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E",
};

export async function validateImageUrl(url, type) {
  if (!url) return placeholderImage[type];

  try {
    const response = await fetch(url, { method: "HEAD" });
    if (
      response.ok &&
      response.headers.get("content-type").startsWith("image/")
    ) {
      return url;
    }
  } catch (error) {
    console.error("Error validating image URL:", error);
  }

  return placeholderImage[type];
}
